generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Company {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  passwordHash String

  contactPerson String?
  phone         String?
  username      String?
  isActive      Boolean @default(true)
  modules       String  @default("{}") 

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  products     Product[]
  devices      Device[]
  repairs      Repair[]
  sales        Sale[]
  suppliers    Supplier[]
  stockMovements StockMovement[]
}



model Device {
  id           Int      @id @default(autoincrement())
  company      Company  @relation(fields: [companyId], references: [id])
  companyId    Int

  customerName String?
  phone        String?
  type         String?
  brand        String?
  model        String?
  serialNumber String?
  description  String?
  status       String   @default("Serviste") // Serviste, Bekliyor, Yedek Parça Bekleniyor, Teslim Edildi
  deliveredAt  DateTime?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  repairs      Repair[]
}


model Repair {
  id           Int      @id @default(autoincrement())
  company      Company  @relation(fields: [companyId], references: [id])
  companyId    Int

  device       Device?  @relation(fields: [deviceId], references: [id])
  deviceId     Int?

  customerName String?
  phone        String?
  problem      String
  status       String   @default("Bekliyor") // Bekliyor, Yapılıyor, Bitti, Teslim Edildi
  price        Float?
  notes        String?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Product {
  id        Int      @id @default(autoincrement())
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id])

  name      String
  quantity  Int      @default(0)
  buyPrice  Float?
  supplier  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  priceHistory ProductPriceHistory[]
  sales        Sale[]  
  stockMovements StockMovement[]
}

model ProductPriceHistory {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id])

  price     Float
  date      DateTime @default(now())
}

model Sale {
  id        Int      @id @default(autoincrement())
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id])

  productId Int?
  product   Product? @relation(fields: [productId], references: [id])

  customer  String?
  quantity  Int      @default(1)
  price     Float
  date      DateTime @default(now())
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  totalAmount Float @default(0)
}

model Supplier {
  id        Int      @id @default(autoincrement())
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id])

  name        String
  contactName String?
  phone       String?
  email       String?
  address     String?
  notes       String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  role         String   @default("ADMIN") // ADMIN, STAFF
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model StockMovement {
  id        Int      @id @default(autoincrement())
  company   Company  @relation(fields: [companyId], references: [id])
  companyId Int

  product   Product  @relation(fields: [productId], references: [id])
  productId Int

  type      String   // "IN" veya "OUT"
  quantity  Int
  reason    String?  // "SALE", "MANUAL", "CORRECTION" vs.
  createdAt DateTime @default(now())
}
